rule RansomwareGeneric {
    meta:
        description = "Generic ransomware detection patterns"
        author = "Virus Scanner API"
        confidence = "0.8"
        date = "2024-02-20"

    strings:
        // Common ransomware file extensions
        $ext1 = ".encrypted" nocase
        $ext2 = ".locked" nocase
        $ext3 = ".crypt" nocase
        $ext4 = ".crypted" nocase
        $ext5 = ".cry" nocase
        
        // Common ransom note filenames
        $note1 = "READ_ME.txt" nocase
        $note2 = "HOW_TO_DECRYPT.txt" nocase
        $note3 = "DECRYPT_INSTRUCTIONS.txt" nocase
        
        // Common ransom note content
        $msg1 = "your files have been encrypted" nocase
        $msg2 = "bitcoin" nocase
        $msg3 = "payment" nocase
        $msg4 = "decrypt" nocase
        $msg5 = "ransom" nocase
        
        // Common encryption function names
        $func1 = "CryptoAPI" nocase
        $func2 = "AES_encrypt" nocase
        $func3 = "RSA_encrypt" nocase
        
        // Common file enumeration patterns
        $enum1 = "*.doc" nocase
        $enum2 = "*.docx" nocase
        $enum3 = "*.xls" nocase
        $enum4 = "*.xlsx" nocase
        $enum5 = "*.pdf" nocase
        $enum6 = "*.jpg" nocase
        
        // Common registry modifications
        $reg1 = "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" nocase
        $reg2 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" nocase

    condition:
        // Trigger on combinations of suspicious patterns
        uint16(0) == 0x5A4D and  // PE file
        (
            // Multiple extensions or notes
            (2 of ($ext*) and any of ($note*)) or
            
            // Ransom notes with messages
            (any of ($note*) and 2 of ($msg*)) or
            
            // Encryption functions with file enumeration
            (any of ($func*) and 2 of ($enum*)) or
            
            // Registry persistence with encryption
            (any of ($reg*) and any of ($func*)) or
            
            // Strong combination of indicators
            (3 of ($msg*) and 2 of ($enum*))
        )
} 